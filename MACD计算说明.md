# MACDæ•°æ®è·å–ä¸è®¡ç®—è¯´æ˜

## ğŸ“Š æ ¸å¿ƒå‘ç°

**MACDå¹¶éç›´æ¥ä»æ•°æ®æºè·å–ï¼Œè€Œæ˜¯é€šè¿‡å†å²Kçº¿æ•°æ®è®¡ç®—å¾—å‡ºçš„ï¼**

---

## ğŸ” ä¸¤ç§æ•°æ®æºçš„MACDè®¡ç®—æ–¹æ³•

### 1ï¸âƒ£ **å¸¸è§„æ•°æ®æºï¼ˆBaostock/Tushareï¼‰**

**ä½ç½®**: `a_share_gui_compatible.py` ç¬¬8875-8884è¡Œ

**è®¡ç®—æ–¹æ³•**:
```python
# æ ‡å‡†MACDè®¡ç®— (DIFå¿«çº¿å’ŒDEAä¿¡å·çº¿)
if len(stock_hist) >= 26:
    ema12 = stock_hist['æ”¶ç›˜'].ewm(span=12, adjust=False).mean()
    ema26 = stock_hist['æ”¶ç›˜'].ewm(span=26, adjust=False).mean()
    macd_line = ema12 - ema26  # DIFå¿«çº¿
    signal_line = macd_line.ewm(span=9, adjust=False).mean()  # DEAä¿¡å·çº¿ï¼ˆ9æ—¥EMAï¼‰
    macd = float(macd_line.iloc[-1])
    signal = float(signal_line.iloc[-1])
else:
    macd = 0
    signal = 0
```

**å…³é”®å‚æ•°**:
- **EMA12**: 12æ—¥æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿
- **EMA26**: 26æ—¥æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿
- **MACD (DIF)**: EMA12 - EMA26
- **Signal (DEA)**: MACDçš„9æ—¥EMA
- **æœ€å°æ•°æ®è¦æ±‚**: è‡³å°‘26æ¡Kçº¿æ•°æ®
- **ä½¿ç”¨pandasçš„ewm()æ–¹æ³•**: `adjust=False` (é€’å½’åŠ æƒ)

---

### 2ï¸âƒ£ **Choiceæ•°æ®æº**

**ä½ç½®**: `a_share_gui_compatible.py` ç¬¬18703-18713è¡Œ

**è®¡ç®—æ–¹æ³•**:
```python
# è®¡ç®—MACD
if len(closes) >= 26:
    ema12 = closes_array[-1]
    ema26 = closes_array[-1]
    # æ‰‹åŠ¨é€’å½’è®¡ç®—EMA12
    for i in range(min(12, len(closes))):
        ema12 = closes_array[-(i+1)] * 0.1538 + ema12 * 0.8462
    # æ‰‹åŠ¨é€’å½’è®¡ç®—EMA26
    for i in range(min(26, len(closes))):
        ema26 = closes_array[-(i+1)] * 0.0741 + ema26 * 0.9259
    macd = ema12 - ema26
    signal = macd * 0.2 + macd * 0.8  # âš ï¸ é”™è¯¯çš„è®¡ç®—æ–¹å¼ï¼
else:
    macd = 0
    signal = 0
```

**å…³é”®å‚æ•°**:
- **EMA12æƒé‡**: 0.1538 (â‰ˆ 2/(12+1))
- **EMA26æƒé‡**: 0.0741 (â‰ˆ 2/(26+1))
- **Signalè®¡ç®—**: `macd * 0.2 + macd * 0.8 = macd` âš ï¸ **é”™è¯¯ï¼åº”è¯¥æ˜¯MACDçš„9æ—¥EMA**
- **é€’å½’æ·±åº¦**: ä»…12/26æ¬¡è¿­ä»£ï¼ˆå¸¸è§„æ–¹æ³•ä¼šç”¨å…¨éƒ¨å†å²æ•°æ®ï¼‰

---

## âš ï¸ å·®å¼‚åŸå› åˆ†æ

### **æ ¹æœ¬åŸå› ï¼šChoiceçš„Signalè®¡ç®—é”™è¯¯**

```python
# Choiceå½“å‰ä»£ç ï¼ˆé”™è¯¯ï¼‰:
signal = macd * 0.2 + macd * 0.8  # ç»“æœå°±æ˜¯ macd * 1.0 = macd

# æ­£ç¡®çš„è®¡ç®—åº”è¯¥æ˜¯:
signal = macd_line.ewm(span=9, adjust=False).mean()
```

è¿™å¯¼è‡´Choiceæ•°æ®æºçš„ï¼š
- **MACD â‰ˆ Signal** (å‡ ä¹ç›¸ç­‰)
- **MACDå·®å€¼ â‰ˆ 0** (MACD - Signal â‰ˆ 0)

è€Œå¸¸è§„æ•°æ®æºçš„Signalæ˜¯æ­£ç¡®çš„9æ—¥EMAï¼Œå› æ­¤ï¼š
- **MACD â‰  Signal** 
- **MACDå·®å€¼æœ‰æ˜æ˜¾æ•°å€¼** (å¯èƒ½ä¸ºæ­£æˆ–è´Ÿ)

---

### **æ¬¡è¦åŸå› ï¼šEMAè®¡ç®—æ·±åº¦ä¸åŒ**

| å·®å¼‚ç‚¹ | å¸¸è§„æ•°æ®æº | Choiceæ•°æ®æº |
|--------|-----------|-------------|
| **EMA12è®¡ç®—** | ä½¿ç”¨å…¨éƒ¨å†å²æ•°æ®çš„ewm() | ä»…å‘å‰é€’å½’12æ¬¡ |
| **EMA26è®¡ç®—** | ä½¿ç”¨å…¨éƒ¨å†å²æ•°æ®çš„ewm() | ä»…å‘å‰é€’å½’26æ¬¡ |
| **Signalè®¡ç®—** | âœ… æ­£ç¡®ï¼šMACDçš„9æ—¥EMA | âŒ é”™è¯¯ï¼šç›´æ¥è¿”å›MACDå€¼ |
| **å†å²ä¾èµ–** | å®Œæ•´çš„æŒ‡æ•°åŠ æƒ | éƒ¨åˆ†åŠ æƒï¼ˆåˆå§‹å€¼ä¸ºå½“å‰ä»·ï¼‰ |

---

## ğŸ”§ ä¸æ—¶é—´èŒƒå›´çš„å…³ç³»

### **æ˜¯çš„ï¼ŒMACDè®¡ç®—ä¸è·å–çš„æ—¶é—´èŒƒå›´å¯†åˆ‡ç›¸å…³ï¼**

#### **åŸå› **:
1. **EMAæ˜¯é€’å½’è®¡ç®—çš„**ï¼Œæ¯ä¸ªæ•°æ®ç‚¹ä¾èµ–å‰ä¸€ä¸ªæ•°æ®ç‚¹
2. **å†å²æ•°æ®è¶Šå¤šï¼ŒEMAè¶Šå‡†ç¡®**ï¼ˆå……åˆ†åæ˜ é•¿æœŸè¶‹åŠ¿ï¼‰
3. **æ•°æ®ä¸è¶³æ—¶ï¼ŒEMAè®¡ç®—ä¼šæœ‰åå·®**ï¼ˆç‰¹åˆ«æ˜¯Choiceçš„ç®€åŒ–ç®—æ³•ï¼‰

#### **æœ€å°æ•°æ®è¦æ±‚**:
- **MACDè®¡ç®—**: è‡³å°‘ **26æ¡Kçº¿**
- **æ¨èæ•°æ®é‡**: **60-120æ¡Kçº¿**ï¼ˆä¿è¯EMA26æœ‰è¶³å¤Ÿçš„å†å²æ•°æ®ï¼‰

#### **å½“å‰è·å–èŒƒå›´**:
```python
# å¸¸è§„æ•°æ®æº (Baostock/Tushare)
# é»˜è®¤è·å– 120å¤© (çº¦90-100ä¸ªäº¤æ˜“æ—¥)

# Choiceæ•°æ®æº
start_date = (datetime.now() - timedelta(days=90)).strftime("%Y-%m-%d")
# è·å– 90å¤© (çº¦60ä¸ªäº¤æ˜“æ—¥)
```

---

## ğŸ“ˆ å®é™…æ¡ˆä¾‹å¯¹æ¯”ï¼ˆ600036ï¼‰

| æ•°æ®æº | MACD | Signal | MACDå·®å€¼ | è¯´æ˜ |
|--------|------|--------|---------|------|
| **å¸¸è§„** | -0.0658 | 0.1632 | **-0.2290** | Signalæ˜¯MACDçš„9æ—¥EMAï¼ˆæ­£ç¡®ï¼‰ |
| **Choice** | 0.0948 | 0.0948 | **â‰ˆ0.0000** | Signalâ‰ˆMACDï¼ˆé”™è¯¯ï¼ï¼‰ |

### **å½±å“è¯„åˆ†**:
- **MACDè¯„åˆ†**: å¸¸è§„-3.0åˆ† vs Choice 0åˆ†
- **çŸ­æœŸè¯„åˆ†**: å¸¸è§„1.0/10 vs Choice 2.5/10
- **å·®å¼‚**: **1.5åˆ†**

---

## ğŸ’¡ å»ºè®®ä¿®å¤æ–¹æ¡ˆ

### **ä¿®å¤Choiceæ•°æ®æºçš„Signalè®¡ç®—**

éœ€è¦å°†Choiceçš„MACDè®¡ç®—æ”¹ä¸ºï¼š

```python
# ä¿®å¤åçš„ä»£ç 
if len(closes) >= 26:
    # 1. æ­£ç¡®è®¡ç®—EMA12å’ŒEMA26
    closes_series = pd.Series(closes)
    ema12 = closes_series.ewm(span=12, adjust=False).mean()
    ema26 = closes_series.ewm(span=26, adjust=False).mean()
    
    # 2. è®¡ç®—MACD (DIFå¿«çº¿)
    macd_line = ema12 - ema26
    
    # 3. æ­£ç¡®è®¡ç®—Signal (DEAä¿¡å·çº¿ - MACDçš„9æ—¥EMA)
    signal_line = macd_line.ewm(span=9, adjust=False).mean()
    
    macd = float(macd_line.iloc[-1])
    signal = float(signal_line.iloc[-1])
```

---

## ğŸ“Œ æ€»ç»“

1. âœ… **MACDæ˜¯è®¡ç®—å‡ºæ¥çš„**ï¼Œä¸æ˜¯ç›´æ¥ä»APIè·å–
2. âœ… **ä¸æ—¶é—´èŒƒå›´å¯†åˆ‡ç›¸å…³**ï¼Œå†å²æ•°æ®è¶Šå¤šè¶Šå‡†ç¡®
3. âš ï¸ **Choiceå½“å‰çš„Signalè®¡ç®—æœ‰è¯¯**ï¼Œå¯¼è‡´MACDå·®å€¼â‰ˆ0
4. ğŸ”§ **å»ºè®®ä¿®å¤Choiceç®—æ³•**ï¼Œç»Ÿä¸€ä½¿ç”¨pandasçš„ewm()æ–¹æ³•
5. ğŸ“Š **æ¨èè·å–120å¤©æ•°æ®**ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å†å²æ•°æ®è®¡ç®—EMA

---

## ğŸ”— ç›¸å…³ä»£ç ä½ç½®

- å¸¸è§„MACDè®¡ç®—: [a_share_gui_compatible.py#L8875-L8884](d:\TradingAgents\a_share_gui_compatible.py#L8875-L8884)
- Choice MACDè®¡ç®—: [a_share_gui_compatible.py#L18703-L18713](d:\TradingAgents\a_share_gui_compatible.py#L18703-L18713)
- Choiceæ•°æ®è·å–: [a_share_gui_compatible.py#L18486-L18750](d:\TradingAgents\a_share_gui_compatible.py#L18486-L18750)
