# 数据日期颜色警告功能说明

## 功能概述

为GUI界面的数据状态标签添加了基于日期的颜色警告功能，让用户一眼就能看出数据的新旧程度。

## 颜色编码规则

- **🟢 绿色 (#27ae60)**: 当天的数据（最新）
- **🟡 黄色 (#f39c12)**: 1-5天前的数据（需要注意）
- **🔴 红色 (#e74c3c)**: 超过5天的数据或错误状态（需要更新）

## 实现细节

### 1. 修改的状态检查函数

三个状态检查函数都添加了日期差异计算：

- `_check_comprehensive_data_status()` - 全部数据状态
- `_check_kline_data_status()` - K线数据状态  
- `_check_score_data_status()` - 评分数据状态

这些函数现在会在返回的状态文本中添加隐藏的 `[AGE:X]` 标记，其中X是天数差异。

### 2. 颜色判断逻辑

`_get_status_color(status_text)` 函数提取 `[AGE:X]` 标记并根据天数返回对应颜色：

```python
if days_old == 0:
    return "#27ae60"  # 绿色 - 当天
elif days_old <= 5:
    return "#f39c12"  # 黄色 - 1-5天
else:
    return "#e74c3c"  # 红色 - 超过5天
```

### 3. 显示更新

`check_data_status()` 和 `_refresh_kline_status()` 函数：
1. 调用状态检查函数获取带 `[AGE:X]` 标记的状态文本
2. 使用 `_get_status_color()` 提取标记并计算颜色
3. 用正则表达式移除 `[AGE:X]` 标记得到干净的显示文本
4. 同时设置标签的文本和颜色

## 使用示例

启动应用后，界面上的三个数据状态标签会自动显示对应颜色：

- **本地数据**: `2024-01-20 (16个文件)` - 绿色（当天）
- **K线数据**: `2024-01-18` - 黄色（2天前）
- **评分数据**: `2024-01-10 14:30 | DeepSeek AI` - 红色（10天前）

## 测试验证

运行 `test_color_coding.py` 可以验证颜色判断逻辑：

```bash
python test_color_coding.py
```

测试包含12个场景，覆盖：
- 当天数据（绿色）
- 1-5天数据（黄色）
- 超过5天数据（红色）
- 错误状态（红色）

## 注意事项

1. **天数计算基于文件修改时间**：对于全部数据和K线数据，使用文件的修改时间戳计算天数差异
2. **评分数据使用实际日期**：评分数据从文件名或内容中提取实际日期进行计算
3. **自动刷新**：状态检查每秒自动运行一次，颜色会实时更新
4. **错误状态优先**：包含"无"或"失败"的状态总是显示红色，不考虑日期

## 代码位置

- 状态检查函数：lines 756-889
- 颜色判断函数：lines 920-945  
- 状态更新逻辑：lines 731-755
- K线状态刷新：lines 947-962
